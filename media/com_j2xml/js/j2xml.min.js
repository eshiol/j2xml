/**
 * @package     Joomla.Site
 * @subpackage  com_j2xml
 *
 * @author      Helios Ciancio <info (at) eshiol (dot) it>
 * @link        https://www.eshiol.it
 * @copyright   Copyright (C) 2010 - 2023 Helios Ciancio. All Rights Reserved
 * @license     http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL v3
 * J2XML is free software. This version may have been modified pursuant
 * to the GNU General Public License, and as distributed it includes or
 * is derivative of works licensed under the GNU General Public License
 * or other free or open source software licenses.
 */
!function(){var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];console=window.console=window.console||{},methods.forEach((function(method){console[method]||(console[method]=function(){})})),console.dump=function(object){window.JSON&&window.JSON.stringify?console.log(JSON.stringify(object)):console.log(object)}}(),"undefined"==typeof eshiol&&(eshiol={}),void 0===eshiol.j2xml&&(eshiol.j2xml={}),void 0===eshiol.j2xml.com_j2xml&&(eshiol.j2xml.com_j2xml={}),eshiol.j2xml.com_j2xml.version="__DEPLOY_VERSION__",console.log("J2XML v"+eshiol.j2xml.com_j2xml.version),eshiol.j2xml.importerModal=function(){console.log("eshiol.j2xml.importerModal"),jQuery("#j2xmlImportModal iframe").contents().find("#adminForm input[name^=jform], #adminForm select[name^=jform]").each((function(index){var input=jQuery(this);jQuery("<input>").attr({type:"hidden",id:input.attr("id"),name:input.attr("name"),value:input.val()}).appendTo("#adminForm")})),window.top.setTimeout("window.parent.jQuery('#j2xmlImportModal').modal('hide')",700),xmlDoc=jQuery.parseXML(base64.decode(jQuery("#j2xml_data").val())),$xml=jQuery(xmlDoc),root=$xml.find(":root")[0],$root=jQuery(root),header='<?xml version="1.0" encoding="UTF-8" ?>\n<j2xml version="'+$root.attr("version")+'">\n',footer="\n</j2xml>";var nodes=[];$root.children("user").each((function(index){console.log("user: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("tag").each((function(index){console.log("tag: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("category").each((function(index){console.log("category: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("fieldgroup").each((function(index){console.log("fieldgroup: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("field").each((function(index){console.log("field: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("content").each((function(index){console.log("content: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("menutype").each((function(index){console.log("menutype: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("menu").each((function(index){console.log("menu: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children("module").each((function(index){console.log("module: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer)})),$root.children().each((function(index){-1==["base","user","tag","category","content","fieldgroup","field","menutype","menu","module"].indexOf(this.nodeName)&&(console.log("other: "+header+eshiol.XMLToString(this)+footer),nodes.push(header+eshiol.XMLToString(this)+footer))})),eshiol.removeMessages();var options={tot:nodes.length,info:0,success:0,warning:0,error:0};if(void 0!==Joomla.getOptions)var progressBarContainerClass=Joomla.getOptions("progressBarContainerClass","progress progress-striped active"),progressBarClass=Joomla.getOptions("progressBarClass","bar bar"),progressBarErrorClass=Joomla.getOptions("progressBarErrorClass","bar bar-danger");else var progressBarContainerClass="progress progress-striped active",progressBarClass="bar bar",progressBarErrorClass="bar bar-warning";jQuery("#import-progress").remove(),jQuery('<div id="import-progress" class="import-progress"><div class="'+progressBarContainerClass+'" style="font-size:1rem;height:1.5rem"><div id="import-progress-bar-info" class="'+progressBarClass+'-info"></div><div id="import-progress-bar-success" class="'+progressBarClass+'-success"></div><div id="import-progress-bar-warning" class="'+progressBarClass+'-warning"></div><div id="import-progress-bar-error" class="'+progressBarErrorClass+'"></div></div></div>').insertAfter("#system-message-container"),eshiol.j2xml.importer(nodes,options)},eshiol.j2xml.importer=function(nodes,options){if(console.log("eshiol.j2xml.importer"),nodes.length>0){item=nodes.shift();var token=jQuery("#installer-token").val(),url="index.php?option=com_j2xml&task=import.ajax_upload",data=new FormData,blob=new Blob([(new TextEncoder).encode(item)],{type:"text/xml"});data.append("install_package",blob,jQuery("#j2xml_filename").val()),data.append("installtype","upload"),data.append(token,1),jQuery("#j2xmlImportModal iframe").contents().find("#adminForm input:not(:radio)[name^=jform], #adminForm input:radio[name^=jform]:checked, #adminForm select[name^=jform]").each((function(index){var input=jQuery(this);data.append(input.attr("name"),input.val())})),JoomlaInstaller.showLoading(),jQuery.ajax({url:url,data:data,type:"post",processData:!1,cache:!1,contentType:!1,error:function(error){console.log("error"),console.log(error),JoomlaInstaller.hideLoading(),eshiol.renderMessages({error:[error.responseText]}),jQuery("#import-progress-bar-info").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),jQuery("#import-progress-bar-success").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),jQuery("#import-progress-bar-error").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),jQuery("#import-progress-bar-warning").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),setTimeout((function(){jQuery("#import-progress").remove()}),1e4)}}).done((function(res){if(console.log("done"),res.messages)jQuery.each(res.messages,(function(type,message){if(console.log(type+" "+message),"notice"==type)options.info++,jQuery("#import-progress-bar-info").css("width",100*options.info/options.tot+"%").text(options.info);else if("message"==type)options.success++,jQuery("#import-progress-bar-success").css("width",100*options.success/options.tot+"%").text(options.success);else if("error"==type){var j2xmlOptions=Joomla.getOptions("J2XML");j2xmlOptions&&j2xmlOptions.HaltOnError?(options.error=options.tot-options.info-options.success-options.warning,jQuery("#import-progress-bar-error").css("width",100*options.error/options.tot+"%").html(message),nodes=[]):(options.error++,jQuery("#import-progress-bar-error").css("width",100*options.error/options.tot+"%").text(options.error))}else options.warning++,jQuery("#import-progress-bar-warning").css("width",100*options.warning/options.tot+"%").text(options.warning)})),eshiol.renderMessages(res.messages);else if(res.message)if(res.success){options.success++;var progress=100*options.success/options.tot;jQuery("#import-progress-bar-success").css("width",progress+"%").text(options.success),console.log("#import-progress-bar-success.width: "+progress),eshiol.renderMessages({message:[res.message]})}else options.error++,jQuery("#import-progress-bar-error").css("width",100*options.error/options.tot+"%").text(options.error),eshiol.renderMessages({error:[res.message]});else options.tot--,jQuery("#import-progress-bar-info").css("width",100*options.info/options.tot+"%"),jQuery("#import-progress-bar-success").css("width",100*options.success/options.tot+"%"),jQuery("#import-progress-bar-error").css("width",100*options.error/options.tot+"%"),jQuery("#import-progress-bar-warning").css("width",100*options.warning/options.tot+"%");elements=document.getElementById("system-message-container").childNodes,"undefined"!=typeof elements&&null!=elements&&(element=elements[elements.length-2],"undefined"!=typeof element&&null!=element&&element.scrollIntoView()),jQuery.ajax({url:"index.php"}).done((function(res){0==nodes.length&&JoomlaInstaller.hideLoading(),eshiol.j2xml.importer(nodes,options)}))}))}else jQuery("#import-progress-bar-info").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),jQuery("#import-progress-bar-success").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),jQuery("#import-progress-bar-error").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),jQuery("#import-progress-bar-warning").removeClass("progress-bar-striped").removeClass("progress-bar-animated"),setTimeout((function(){jQuery("#import-progress").remove()}),1e4)};